<html>
  <head>
    <script src="http://ease-62q56ueo.cloudapp.net/libs/ease.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script>
      $(document).ready(function() {
        //var ease = new Ease("hi@example.com", "app", "buXOEAfmXmRwJHafvSFCpnXkNjZElH");
        //var ease = new Ease("nate@gmail.fake", "Test1", "odTFDdUyQBFoZCwUjnpEpSQidSMeac");
        var ease = new Ease("hi@example.com", "testapp", "kVemLBIrLiBQrAECUBsPFFVuGEOHWW");

        ease.baseUrl = '162.243.71.202:3001';
        //ease.baseUrl = 'localhost:3001';

        // For messing around in the console.
        window.ease = ease;

        refreshMessages(ease);

        setInterval(function() {
          refreshMessages(ease);
        }, 200);

        $("#chatform").submit(function(evt) {
          console.log("Form submitted...")
          evt.preventDefault();
          var inputText = $("#chatinput").val();
          $("#chatinput").val("");
          ease.read("/messages", function(err, messages) {
            if (err) {
              console.log("Error reading messages.");
              return;
            }
            if (messages == null) {
              messages = [];
            }
            messages.push(inputText);
            ease.save("/messages", messages, function(err) {
              if (err) {
                console.log("Error communicating with server.");
                return;
              }
              refreshMessages(ease);
            });
          });
          return false;
        })
      });

      var messageCount = 0;
      function refreshMessages(ease) {
        console.log("Refreshing messages...");
        var messageList = $("#messagelist");
        ease.read("/messages", function(err, messages) {
          if (err || messages == null) {
            return;
          }
          if (messageCount == messages.length) {
            return;
          }
          messageCount = messages.length;
          messageList.empty();
          console.log("Messages: " + messages);
          for (var i = 0; i < messages.length; i++) {
            messageList.append("<li>" + messages[i] + "</li>");
          }
        });
      }
    </script>

    <style>
      #messagelist {
        height: 200px;
        width: 200px;
        list-style-type: none;
        text-align: center;
        padding-left: 0px;
      }
      #messagelist li {
        margin-bottom: 2px;
        background-color: #ddd;
      }
    </style>

  </head>
  <body>
    <h1>Chat Demo!</h1>
    <h2>Messages</h2>
    <ul id="messagelist">
    </ul>
    <form id="chatform">
      <input type="text" id="chatinput">
      <input type="submit" value="Send message!">
    </form>
  </body>
</html>
